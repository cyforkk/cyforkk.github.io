# 每日计划数据管理说明

## 📁 文件位置

- **数据文件**: `source/_data/plans.yml`
- **JavaScript**: `source/js/plan.js`
- **生成器插件**: `scripts/plans-generator.js`
- **页面文件**: `source/plan/index.md`

## 📝 如何添加新的计划

只需编辑 `source/_data/plans.yml` 文件，按照以下格式添加：

```yaml
plans:
  - date: 2026-01-10  # 日期格式：YYYY-MM-DD
    tasks:
      - text: 任务内容1
        completed: true   # true=已完成, false=未完成
      - text: 任务内容2
        completed: false
      - text: 任务内容3
        completed: true

  - date: 2026-01-09
    tasks:
      - text: 另一天的任务
        completed: true
```

## 🔄 更新流程

1. **编辑数据文件**
   ```bash
   # 打开并编辑
   notepad source/_data/plans.yml
   ```

2. **生成静态文件**
   ```bash
   hexo clean && hexo generate
   ```

3. **本地预览**
   ```bash
   hexo server
   ```
   访问: http://localhost:4000/plan/

4. **部署到服务器**
   ```bash
   hexo deploy
   ```

## ✨ 功能特点

- ✅ **数据与页面分离**: 所有计划数据集中在 `plans.yml` 动排序**: 按日期倒序显示（最新的在前）
- ✅ **折叠展开**: 每个日期的任务可以折叠/展开
- ✅ **分页显示**: 超过10条自动分页
- ✅ **完成状态**: 已完成的任务会显示删除线
- ✅ **美观样式**: 继承了之前的所有美化效果

## 📋 YAML 格式说明

### 基本结构
```yaml
plans:              # 根节点（必需）
  - date: 日期      # 每个计划项（必需）
    tasks:          # 任务列表（必需）
      - text: 内容  # 任务文本（必需）
        completed: 状态  # 完成状态（必需）
```

### 注意事项

1. **缩进**: 使用2个空格缩进，不要使用 Tab
2. **日期格式**: 必须是 `YYYY-MM-DD` 格式
3. **布尔值**: `completed` 只能是 `true` 或 `false`（小写）
4. **特殊字符**: 如果任务内容包含 `:` 或 `#`，需要用引号包裹

### 示例

```yaml
plans:
  - date: 2026-01-10
    tasks:
      - text: "完成功能: 用户登录"  # 包含冒号，需要引号
        completed: true
      - text: 修复 Bug #123        # 包含 #，需要引号
        completed: false
      - text: 普通任务
        completed: true
```

## 🛠️ 工作原理

1. **YAML → JSON**: `scripts/plans-generator.js` 在生成时将 `plans.yml` 转换为 `plans.json`
2. **动态加载**: `source/js/plan.js` 通过 AJAX 加载 `plans.json`
3. **渲染页面**: JavaScript 动态生成 HTML 并插入到页面中

## 🔧 故障排查

### 问题1: 页面显示"加载中..."不消失

**原因**: JSON 文件加载失败

**解决方法**:
1. 检查 `source/_data/plans.yml` 格式是否正确
2. 运行 `hexo clean && hexo generate` 重新生成
3. 检查浏览器控制台是否有错误信息

### 问题2: YAML 解析错误

**原因**: YAML 格式不正确

**解决方法**:
1. 检查缩进是否使用2个空格
2. 检查是否有多余的空格或制表符
3. 使用在线 YAML 验证器检查格式

### 问题3: 日期显示不正确

**原因**: 日期格式错误

**解决方法**:
- 确保日期格式为 `YYYY-MM-DD`
- 例如: `2026-01-09` ✅
- 错误: `2026/01/09` ❌

## 📊 数据备份

建议定期备份 `source/_data/plans.yml` 文件：

```bash
# 复制到备份目录
cp source/_data/plans.yml backup/plans_$(date +%Y%m%d).yml

# 或者使用 Git 版本控制
git add source/_data/plans.yml
git commit -m "更新每日计划数据"
```

## 🎨 自定义样式

如果需要修改样式，编辑 `source/plan/index.md` 中的 `<style>` 部分。

## 📚 扩展功能

### 添加优先级

可以扩展 YAML 结构添加优先级：

```yaml
plans:
  - date: 2026-01-10
    tasks:
      - text: 紧急任务
        completed: false
        priority: high  # 新增字段
      - text: 普通任务
        completed: false
        priority: normal
```

然后修改 `source/js/plan.js` 来显示优先级标识。

### 添加标签

```yaml
plans:
  - date: 2026-01-10
    tasks:
      - text: 前端开发任务
        completed: true
        tags: [前端, React]  # 新增字段
```

## 💡 最佳实践

1. **每天更新**: 建议每天结束时更新当天的完成状态
2. **提前规划**: 可以提前添加未来几天的计划
3. **定期清理**: 定期删除或归档很久以前的计划
4. **详细描述**: 任务描述要清晰明确
5. **版本控制**: 使用 Git 跟踪 `plans.yml` 的变更历史

## 📞 技术支持

如果遇到问题，可以：
1. 检查浏览器控制台的错误信息
2. 查看 Hexo 生成日志
3. 验证 YAML 文件格式
4. 确保所有文件路径正确

---

**最后更新**: 2026-01-09
